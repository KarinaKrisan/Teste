<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Painel Operacional | Escala Sitelbra</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <link rel="stylesheet" href="styless.css">
</head>
<body class="text-gray-300 bg-[#0F1020]">

    <!-- Toolbar Administrativa (Fixo no topo) - APENAS ADMIN -->
    <div id="adminToolbar" class="hidden fixed top-0 w-full bg-gradient-to-r from-purple-900 to-indigo-900 text-white z-50 shadow-lg border-b border-purple-500/30">
        <div class="container mx-auto px-4 py-2 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-white/10 p-1.5 rounded-lg"><i class="fas fa-shield-alt text-purple-300"></i></div>
                <span class="font-bold text-sm tracking-wide">MODO ADMINISTRADOR (LÍDER)</span>
            </div>
            <div class="flex items-center gap-4">
                <button id="btnSaveCloud" class="text-xs bg-white/10 hover:bg-white/20 px-3 py-1.5 rounded-md transition-all flex items-center gap-2 border border-white/10">
                    <i class="fas fa-cloud-upload-alt"></i> Salvar
                </button>
                <div class="flex items-center gap-2 bg-black/20 px-3 py-1 rounded-full">
                    <div id="saveStatusIcon" class="w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.6)]"></div>
                    <span id="saveStatus" class="text-xs text-gray-300 font-medium">Sincronizado</span>
                </div>
                <button id="btnLogout" class="text-xs text-red-300 hover:text-white hover:bg-red-500/20 px-2 py-1 rounded transition-colors"><i class="fas fa-sign-out-alt"></i> Sair</button>
            </div>
        </div>
    </div>

    <div class="container mx-auto p-4 max-w-6xl mt-12">

        <header class="mb-10 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="text-center md:text-left">
                <h1 class="text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 mb-2 tracking-tight">Painel Operacional Sitelbra</h1>
                <p class="text-sm text-gray-400 font-medium">Gestão de Escalas e Plantões</p>
            </div>
            
            <div class="flex flex-col gap-2 items-end">
                <div id="monthSelectorContainer"></div>
                
                <!-- Header de Usuário Comum (Colaborador) -->
                <div id="userHeaderInfo" class="hidden flex items-center gap-3 bg-[#1A1C2E] px-3 py-1.5 rounded-lg border border-[#2E3250] shadow-sm">
                    <span id="userEmailDisplay" class="text-xs text-gray-400 font-mono hidden md:inline"></span>
                    <button id="btnLogoutHeader" class="text-xs text-red-400 hover:text-red-300 border border-red-500/30 px-3 py-1 rounded transition-colors hover:bg-red-500/10 font-bold">
                        <i class="fas fa-sign-out-alt mr-1"></i> Sair
                    </button>
                </div>
            </div>
        </header>

        <nav class="flex flex-wrap gap-2 p-1.5 mb-8 bg-[#1A1C2E] rounded-xl shadow-lg border border-[#2E3250] justify-center md:justify-start">
            <button data-tab="daily" class="tab-button active text-sm px-6 py-2.5 rounded-lg font-medium transition-all flex items-center gap-2">
                <i class="fas fa-chart-pie"></i> Visão Diária
            </button>
            <button data-tab="personal" class="tab-button text-sm px-6 py-2.5 rounded-lg font-medium transition-all flex items-center gap-2">
                <i class="fas fa-calendar-alt"></i> Escala & Plantões
            </button>
            <button id="btnAdminRequestsTab" data-tab="adminRequests" class="hidden tab-button text-sm px-6 py-2.5 rounded-lg font-medium transition-all flex items-center gap-2 text-yellow-500 border-yellow-500/30 bg-yellow-500/10">
                <i class="fas fa-inbox"></i> Gestão de Solicitações
            </button>
        </nav>

        <main>
            <!-- Visão Diária -->
            <div id="dailyView" class="tab-content active space-y-8">
                <section class="cronos-card p-6 md:p-8 rounded-2xl">
                    <div class="mb-8 pb-4 border-b border-[#2E3250]">
                       <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-gray-200">Status da Equipe em:</h2>
                            <span id="currentDateLabel" class="text-2xl md:text-3xl font-extrabold text-indigo-400 capitalize block"></span>
                       </div>
                        <label for="dateSlider" class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Navegar pelo mês</label>
                        <input id="dateSlider" type="range" min="1" value="1" class="w-full">
                        <div class="flex justify-between text-xs text-gray-500 mt-2 font-mono">
                            <span>Dia 01</span>
                            <span id="sliderMaxLabel">Fim</span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-stretch">
                        <div class="grid grid-cols-2 gap-4 h-full">
                            <!-- KPI Cards -->
                            <div class="bg-[#161828] p-5 rounded-xl border-t-2 border-green-500 shadow-lg">
                               <p class="text-xs font-bold text-green-500 uppercase">Trabalhando</p>
                                <p id="kpiWorking" class="text-4xl font-extrabold text-white mt-1">0</p>
                            </div>
                            <div class="bg-[#161828] p-5 rounded-xl border-t-2 border-pink-500 shadow-lg">
                                <p class="text-xs font-bold text-pink-500 uppercase">Exp. Encerrado</p>
                                <p id="kpiOffShift" class="text-4xl font-extrabold text-white mt-1">0</p>
                            </div>
                            <div class="bg-[#161828] p-5 rounded-xl border-t-2 border-yellow-500 shadow-lg">
                                <p class="text-xs font-bold text-yellow-500 uppercase">Folga</p>
                                <p id="kpiOff" class="text-4xl font-extrabold text-white mt-1">0</p>
                            </div>
                             <div class="bg-[#161828] p-5 rounded-xl border-t-2 border-red-500 shadow-lg">
                                 <p class="text-xs font-bold text-red-500 uppercase">Férias</p>
                                <p id="kpiVacation" class="text-4xl font-extrabold text-white mt-1">0</p>
                            </div>
                        </div>

                        <div class="flex flex-col bg-[#161828] rounded-xl p-6 border border-[#2E3250] shadow-lg relative h-full">
                            <div class="flex justify-between items-center mb-6 pb-2 border-b border-[#2E3250]">
                                <h3 id="chartTitle" class="text-lg font-bold text-gray-200">Capacidade</h3>
                                <button id="btnToggleChart" onclick="toggleChartMode()" class="text-xs bg-[#2E3250] text-indigo-400 border border-indigo-500/30 px-3 py-1 rounded hover:bg-[#374151] transition-colors">
                                    Ver Tendência
                                </button>
                            </div>
                            <div class="chart-container flex-1 w-full min-h-[250px] relative">
                                 <canvas id="dailyChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="cronos-card rounded-2xl flex flex-col overflow-hidden h-96">
                        <div class="bg-green-900/40 p-3 border-b border-green-900/50"><h3 class="font-bold text-green-400 text-center text-sm uppercase">Trabalhando</h3></div>
                        <div class="p-4 overflow-y-auto flex-1 custom-scrollbar"><ul id="listWorking" class="space-y-1"></ul></div>
                    </div>
                    <div class="cronos-card rounded-2xl flex flex-col overflow-hidden h-96">
                        <div class="bg-pink-900/40 p-3 border-b border-pink-900/50"><h3 class="font-bold text-pink-400 text-center text-sm uppercase">Exp. Encerrado</h3></div>
                        <div class="p-4 overflow-y-auto flex-1 custom-scrollbar"><ul id="listOffShift" class="space-y-1"></ul></div>
                    </div>
                    <div class="cronos-card rounded-2xl flex flex-col overflow-hidden h-96">
                        <div class="bg-yellow-900/40 p-3 border-b border-yellow-900/50"><h3 class="font-bold text-yellow-400 text-center text-sm uppercase">Folga</h3></div>
                        <div class="p-4 overflow-y-auto flex-1 custom-scrollbar"><ul id="listOff" class="space-y-1"></ul></div>
                    </div>
                    <div class="cronos-card rounded-2xl flex flex-col overflow-hidden h-96">
                        <div class="bg-red-900/40 p-3 border-b border-red-900/50"><h3 class="font-bold text-red-400 text-center text-sm uppercase">Férias</h3></div>
                         <div class="p-4 overflow-y-auto flex-1 custom-scrollbar"><ul id="listVacation" class="space-y-1"></ul></div>
                    </div>
                </section>
            </div>

            <!-- Visão Pessoal (Escala) -->
            <div id="personalView" class="tab-content hidden space-y-8">
                <section class="cronos-card p-6 md:p-8 rounded-2xl">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 border-b pb-4 border-[#2E3250]">
                        <div>
                             <h2 class="text-2xl font-bold text-white">Escala Individual</h2>
                            <p class="text-gray-500 text-sm mt-1">Identifique-se para ver sua escala e solicitar trocas.</p>
                        </div>
                         <div class="mt-4 md:mt-0 w-full md:w-80 relative">
                            <select id="employeeSelect" class="appearance-none w-full p-3 bg-[#0F1020] border border-[#2E3250] rounded-xl text-gray-200 text-base font-semibold focus:border-purple-500 outline-none transition-all shadow-inner">
                                <option value="">Selecione seu nome</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                    </div>

                    <div id="personalInfoCard" class="hidden opacity-0 transition-opacity duration-300"></div>
                    
                    <!-- Painel de Ações do Colaborador -->
                    <div id="collaboratorActionsPanel" class="hidden mb-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Botões de Ação -->
                        <div class="bg-[#161828] p-4 rounded-xl border border-[#2E3250] flex flex-col justify-center gap-3">
                            <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-1">Solicitar Alteração</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <button id="btnNewReqShift" class="bg-indigo-600 hover:bg-indigo-500 text-white p-3 rounded-lg text-sm font-bold transition-colors flex flex-col items-center gap-2">
                                    <i class="fas fa-calendar-times text-xl"></i>
                                    <span>Troca de Turno / Folga</span>
                                </button>
                                <button id="btnNewReqSwap" class="bg-purple-600 hover:bg-purple-500 text-white p-3 rounded-lg text-sm font-bold transition-colors flex flex-col items-center gap-2">
                                    <i class="fas fa-user-friends text-xl"></i>
                                    <span>Troca com Parceiro</span>
                                </button>
                            </div>
                        </div>

                        <!-- Lista de Solicitações -->
                        <div class="bg-[#161828] p-4 rounded-xl border border-[#2E3250] flex flex-col h-48">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider">Minhas Solicitações</h3>
                                <span class="text-[10px] text-gray-600">Histórico Recente</span>
                            </div>
                            <div id="listMyRequests" class="overflow-y-auto flex-1 custom-scrollbar pr-1">
                                <!-- Preenchido via JS -->
                            </div>
                        </div>

                        <!-- Aprovações Pendentes (Gabriel vendo pedido da Karina) -->
                        <div class="bg-[#161828] p-4 rounded-xl border border-[#2E3250] flex flex-col md:col-span-2">
                            <div class="flex items-center gap-2 mb-3">
                                <h3 class="text-sm font-bold text-yellow-500 uppercase tracking-wider">Aprovações Pendentes</h3>
                                <span id="pendingCountBadge" class="hidden bg-red-500 text-white text-[10px] font-bold px-1.5 rounded-full">0</span>
                            </div>
                            <div id="listPendingApprovals" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <!-- Preenchido via JS -->
                            </div>
                        </div>
                    </div>

                    <div id="calendarContainer" class="hidden">
                        <div id="adminEditHint" class="hidden mb-2 text-xs text-purple-400 font-bold text-right"><i class="fas fa-info-circle"></i> Clique nos dias para alterar rapidamente</div>
                        <div class="grid grid-cols-7 gap-1 mb-1 text-center font-semibold text-gray-500 hidden md:grid">
                            <div class="text-xs uppercase tracking-wider p-2">Dom</div>
                            <div class="text-xs uppercase tracking-wider p-2">Seg</div>
                            <div class="text-xs uppercase tracking-wider p-2">Ter</div>
                            <div class="text-xs uppercase tracking-wider p-2">Qua</div>
                            <div class="text-xs uppercase tracking-wider p-2">Qui</div>
                            <div class="text-xs uppercase tracking-wider p-2">Sex</div>
                            <div class="text-xs uppercase tracking-wider p-2">Sáb</div>
                          </div>
                        <div id="calendarGrid"></div>
                    </div>
                </section>

                <section class="cronos-card p-6 md:p-8 rounded-2xl">
                    <div class="mb-6">
                        <h2 class="text-xl font-bold text-white flex items-center">
                            <i class="fas fa-layer-group text-indigo-500 mr-2"></i>
                            Plantão Fins de Semana
                          </h2>
                        <p class="text-sm text-gray-500">Visão consolidada das equipes escaladas.</p>
                    </div>
                    <div id="weekendPlantaoContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </section>
            </div>

            <!-- Visão Admin (Gestão de Solicitações) -->
            <div id="adminRequestsView" class="tab-content hidden space-y-8">
                <section class="cronos-card p-6 md:p-8 rounded-2xl">
                    <div class="border-b border-[#2E3250] pb-6 mb-6">
                        <h2 class="text-2xl font-bold text-white mb-1">Solicitações da Equipe</h2>
                        <p class="text-gray-500 text-sm">Aprovação final de trocas e alterações de turno.</p>
                    </div>

                    <div id="adminRequestsList" class="space-y-4">
                        <!-- Lista de Cards de Solicitação -->
                    </div>
                </section>
            </div>

        </main>

        <footer class="mt-12 py-6 border-t border-[#2E3250] text-center text-gray-600 text-sm">
            <p class="font-medium">Criado por <a href="https://instagram.com/kakrisan" target="_blank" class="text-purple-500 hover:text-purple-400 font-bold transition-colors">@kakrisan</a></p>
            <p class="text-xs mt-1">&copy; 2025. Todos os direitos reservados.</p>
        </footer>
    </div>

    <!-- Modais -->
    
    <!-- Modal: Solicitação Simples (Turno/Folga) -->
    <div id="modalReqShift" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">
        <div class="bg-[#1A1C2E] border border-[#2E3250] rounded-2xl w-full max-w-md p-6">
            <h3 class="text-xl font-bold text-white mb-4">Solicitar Alteração</h3>
            <form id="formReqShift" class="space-y-4">
                <div>
                    <label class="block text-xs text-gray-400 font-bold mb-1">Colaborador</label>
                    <input type="text" id="reqShiftName" class="w-full bg-[#0F1020] border border-[#2E3250] rounded p-2 text-gray-300" readonly>
                </div>
                <div>
                    <label class="block text-xs text-gray-400 font-bold mb-1">Data</label>
                    <input type="date" id="reqShiftDate" class="w-full bg-[#0F1020] border border-[#2E3250] rounded p-2 text-gray-300" required>
                </div>
                <div>
                    <label class="block text-xs text-gray-400 font-bold mb-1">Tipo</label>
                    <select id="reqShiftType" class="w-full bg-[#0F1020] border border-[#2E3250] rounded p-2 text-gray-300">
                        <option value="troca_turno">Troca de Turno (Manhã ↔ Noite)</option>
                        <option value="folga">Solicitar Folga Extra</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs text-gray-400 font-bold mb-1">Observação</label>
                    <textarea id="reqShiftObs" class="w-full bg-[#0F1020] border border-[#2E3250] rounded p-2 text-gray-300 text-sm" rows="2" placeholder="Ex: Preciso sair mais cedo..."></textarea>
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" class="btn-close-modal flex-1 bg-gray-700 text-gray-300 py-2 rounded font-bold">Cancelar</button>
                    <button type="submit" class="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white py-2 rounded font-bold">Enviar p/ Líder</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Troca com Parceiro -->
    <div id="modalReqSwap" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">
        <div class="bg-[#1A1C2E] border border-[#2E3250] rounded-2xl w-full max-w-md p-6">
            <h3 class="text-xl font-bold text-white mb-4">Troca com Parceiro</h3>
            <p class="text-xs text-gray-400 mb-4">Essa solicitação irá primeiro para o parceiro aceitar, depois para o líder aprovar.</p>
            <form id="formReqSwap" class="space-y-4">
                <input type="hidden" id="reqSwapRequester">
                <div>
                    <label class="block text-xs text-gray-400 font-bold mb-1">Trocar com quem?</label>
                    <select id="reqSwapTarget" class="w-full bg-[#0F1020] border border-[#2E3250] rounded p-2 text-gray-300" required>
                        <!-- Populated by JS -->
                    </select>
                </div>
                <div>
                    <label class="block text-xs text-gray-400 font-bold mb-1">Qual dia você quer trocar?</label>
                    <input type="date" id="reqSwapDate" class="w-full bg-[#0F1020] border border-[#2E3250] rounded p-2 text-gray-300" required>
                </div>
                <div>
                    <label class="block text-xs text-gray-400 font-bold mb-1">Observação</label>
                    <textarea id="reqSwapObs" class="w-full bg-[#0F1020] border border-[#2E3250] rounded p-2 text-gray-300 text-sm" rows="2" placeholder="Ex: Troca da folga de sábado"></textarea>
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" class="btn-close-modal flex-1 bg-gray-700 text-gray-300 py-2 rounded font-bold">Cancelar</button>
                    <button type="submit" class="flex-1 bg-purple-600 hover:bg-purple-500 text-white py-2 rounded font-bold">Solicitar</button>
                </div>
            </form>
        </div>
    </div>

    <script src="escala-data.js"></script>
    <script type="module" src="app.js"></script>
</body>
</html>
